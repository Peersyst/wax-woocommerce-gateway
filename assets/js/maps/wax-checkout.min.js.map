{"version":3,"sources":["wax-checkout.js"],"names":["$","waxPayment","init","initialize","length","this","form","email","data","amount","currency","waxAddress","waxAmount","waxRef","infoWrapper","amountWrapper","process","off","on","payWithWax","bind","is","attr","options","classname","id","target","document","getElementById","nanobar","Nanobar","receiver","memo","wax","waxjs","WaxJS","login","then","ret","console","log","userAccount","toFixed","api","transact","actions","account","name","authorization","actor","permission","from","to","quantity","blocksBehind","expireSeconds","result","showPendingToConfirm","catch","e","error","css","updateWaxAmount","ajaxGetWaxAmount","done","res","success","text","checkForWaxPayment","go","ajax","url","wc_wax_params","wc_ajax_url","type","action","nounce","html","match","trigger","setTimeout","jQuery"],"mappings":"CAAA,SAAAA,GACA,GAAAC,IACAC,KAAA,WAEAF,EAAAG,WAAA,UAAA,WAEAH,EAAA,aAAAI,SACAC,KAAAC,KAAAN,EAAA,aACAK,KAAAE,MAAAF,KAAAC,KAAAE,KAAA,SACAH,KAAAI,OAAAJ,KAAAC,KAAAE,KAAA,UACAH,KAAAK,SAAAL,KAAAC,KAAAE,KAAA,YACAH,KAAAM,WAAAN,KAAAC,KAAAE,KAAA,eACAH,KAAAO,UAAAP,KAAAC,KAAAE,KAAA,cACAH,KAAAQ,OAAAR,KAAAC,KAAAE,KAAA,WACAH,KAAAS,YAAA,YACAT,KAAAU,cAAA,sBACAV,KAAAW,QAAA,gBAIAhB,EAAA,mBAAAiB,IAAA,SACAjB,EAAA,mBAAAkB,GAAA,QAAA,WACAjB,EAAAkB,WAAAd,KAAAM,WAAAN,KAAAO,UAAAP,KAAAQ,SACAO,KAAAf,OAUAL,EAAA,sCAAAqB,GAAA,YACArB,EAAA,gBAAAsB,KAAA,YAAA,GAEAtB,EAAA,gBAAAsB,KAAA,YAAA,GAIAtB,EAAA,6BAAAkB,GAAA,QAAA,+BAAA,WACAlB,EAAAK,MAAAgB,GAAA,uBACArB,EAAA,gBAAAsB,KAAA,YAAA,IAMA,IAAAC,IACAC,UAAA,cACAC,GAAA,cACAC,OAAAC,SAAAC,eAAA,eAGA3B,GAAA4B,QAAA,GAAAC,SAAAP,MAKAJ,WAAA,SAAAY,EAAAtB,EAAAuB,GACA,GAAAC,GAAA,GAAAC,OAAAC,MAAA,2BAAA,KAAA,MAAA,EACAF,GAAAG,QAAAC,KAAA,SAAAC,GACAC,QAAAC,IAAAF,GACAC,QAAAC,IAAAP,EAAAQ,aACAF,QAAAC,IAAAT,GACAQ,QAAAC,IAAA/B,EAAAiC,QAAA,GAAA,QACAH,QAAAC,IAAAR,GAEAC,EAAAU,IAAAC,UACAC,UACAC,QAAA,cACAC,KAAA,WACAC,gBACAC,MAAAhB,EAAAQ,YACAS,WAAA,WAEA1C,MACA2C,KAAAlB,EAAAQ,YACAW,GAAArB,EACAsB,SAAA5C,EAAAiC,QAAA,GAAA,OACAV,KAAAA,OAIAsB,aAAA,EACAC,cAAA,OACAlB,KAAA,SAAAmB,GAEAjB,QAAAC,IAAA,wBAAAgB,GAEAvD,EAAAwD,2BAEAC,MAAA,SAAAC,GACApB,QAAAqB,MAAAD,MAIAF,qBAAA,WACAzD,EAAA,mBAAA6D,IAAA,UAAA,QACA7D,EAAA,oBAAA6D,IAAA,UAAA,UAEAC,gBAAA,WACAzD,KAAA0D,mBAAAC,KAAA,SAAAC,GACA1B,QAAAC,IAAAyB,IAAAA,IAEAA,EAAAC,SAAAD,EAAAzD,KAAAC,OAAA,GACAT,EAAAK,KAAAU,eAAAoD,KAAAF,EAAAzD,KAAAC,WAKA2D,mBAAA,WACA/D,KAAAwB,QAAAwC,GAAA,IACArE,EAAAsE,MACAC,IAAAC,cAAAC,YACAC,KAAA,OACAlE,MACAmE,OAAA,gCACAC,OAAAJ,cAAAI,UAEAZ,KAAA,SAAAC,GACAjE,EAAA,cAAA6E,KAAA,qCAAA,IAGAZ,EAAAC,UAAAA,IAAAD,EAAAzD,KAAAsE,QACA9E,EAAA,gBAAAsB,KAAA,YAAA,GACAtB,EAAA,gBAAA+E,QAAA,UAEAC,WAAA,WACA/E,EAAAmE,sBACA,OAEA/D,KAAAwB,QAAAwC,GAAA,MAGAN,iBAAA,WACA,MAAA/D,GAAAsE,MACAC,IAAAC,cAAAC,YACAC,KAAA,OACAlE,MACAmE,OAAA,6BACAC,OAAAJ,cAAAI,WAMA3E,GAAAC,OACA8E,WAAA,WACA/E,EAAAmE,sBACA,MAEAa","file":"../wax-checkout.min.js","sourcesContent":["(function( $ ) {\n    var waxPayment = {\n        init: function () {\n\n            $.initialize(\"#wax-qr\", function() {\n                //Get form\n                if ( $( '#wax-form' ).length ) {\n                    this.form = $('#wax-form');\n                    this.email = this.form.data('email');\n                    this.amount = this.form.data('amount');\n                    this.currency = this.form.data('currency');\n                    this.waxAddress = this.form.data('wax-address');\n                    this.waxAmount = this.form.data('wax-amount');\n                    this.waxRef = this.form.data('wax-ref');\n                    this.infoWrapper = '#wax-info';\n                    this.amountWrapper = '#wax-amount-wrapper';\n                    this.process = '#wax-process';\n                }\n\n                // TODO: WAX payment button\n                $(\"#wax-pay-button\").off('click');\n                $(\"#wax-pay-button\").on('click', function(){\n                    waxPayment.payWithWax(this.waxAddress, this.waxAmount, this.waxRef);\n                }.bind(this));\n\n                /*Add copy functinality to amount, ref and wax address*/\n                // if(Clipboard.isSupported()){\n                //     new Clipboard('#wax-amount-wrapper');\n                //     new Clipboard('#wax-address-wrapper');\n                //     new Clipboard('#wax-ref-wrapper');\n                // }\n\n                //Set payment button to disabled if whole chech is updated.\n                if($( 'div.payment_box.payment_method_wax' ).is(':visible')){\n                    $( '#place_order' ).attr( 'disabled', true);\n                }else{\n                    $( '#place_order' ).attr( 'disabled', false)\n                }\n\n                /*Set pay button to disabled and start waiting for payments*/\n                $('.wc_payment_methods  > li').on( 'click', 'input[name=\"payment_method\"]',function () {\n                    if ( $( this ).is( '#payment_method_wax' ) ) {\n                        $( '#place_order' ).attr( 'disabled', false);\n                    }else{\n                        $( '#place_order' ).attr( 'disabled', false)\n                    }\n                });\n\n                var options = {\n                    classname: 'nanobar-wax',\n                    id: 'wax-nanobar',\n                    target: document.getElementById('wax-process')\n                };\n\n                waxPayment.nanobar = new Nanobar( options );\n            });\n\n\n        },\n        payWithWax: function (receiver, amount, memo) {\n            var wax = new waxjs.WaxJS('https://wax.greymass.com', null, null, false);\n            wax.login().then(function (ret) {\n                console.log(ret);\n                console.log(wax.userAccount);\n                console.log(receiver);\n                console.log(amount.toFixed(8) + ' WAX');\n                console.log(memo);\n\n                wax.api.transact({\n                    actions: [{\n                      account: 'eosio.token',\n                      name: 'transfer',\n                      authorization: [{\n                        actor: wax.userAccount,\n                        permission: 'active',\n                      }],\n                      data: {\n                        from: wax.userAccount,\n                        to: receiver,\n                        quantity: amount.toFixed(8) + ' WAX',\n                        memo: memo,\n                      },\n                    }],\n                  }, {\n                    blocksBehind: 3,\n                    expireSeconds: 1200\n                  }).then(function (result) {\n                    // contains the transaction id\n                    console.log(\"transaction result ->\", result);\n                    // TODO: should lock the button, show feedback to tell the user the payment has been done -> wait for confirmation\n                    waxPayment.showPendingToConfirm();\n                  });\n            }).catch(function (e) {\n                console.error(e);\n              // User rejected the transaction\n            });\n        },\n        showPendingToConfirm: function () {\n            $('#wax-pay-button').css(\"display\",\"none\");\n            $('#wax-tx-accepted').css(\"display\",\"block\");\n        },\n        updateWaxAmount: function () {\n            this.ajaxGetWaxAmount().done(function (res) {\n                console.log(res);\n\n                if(res.success === true && res.data.amount > 0){\n                    $(this.amountWrapper).text(res.data.amount)\n                }\n            });\n\n        },\n        checkForWaxPayment: function () {\n            this.nanobar.go(25);\n            $.ajax({\n                url: wc_wax_params.wc_ajax_url,\n                type: 'post',\n                data: {\n                    action: 'woocommerce_check_for_payment',\n                    nounce: wc_wax_params.nounce\n                }\n            }).done(function (res) {\n                $('#wax-check').html('<p id=\"wax-check\">Checking..</p>');\n                //console.log(res);\n                //console.log(\"Match: \" + res.data.match);\n                if(res.success === true && res.data.match === true){\n                    $( '#place_order' ).attr( 'disabled', false);\n                    $( '#place_order' ).trigger( 'click');\n                }\n                setTimeout(function() {\n                    waxPayment.checkForWaxPayment();\n                }, 5000);\n            });\n            this.nanobar.go(100);\n        },\n\n        ajaxGetWaxAmount: function () {\n            return $.ajax({\n                url: wc_wax_params.wc_ajax_url,\n                type: 'post',\n                data: {\n                    action: 'woocommerce_get_wax_amount',\n                    nounce: wc_wax_params.nounce\n                }\n            })\n        }\n    };\n\n    waxPayment.init();\n    setTimeout(function() {\n        waxPayment.checkForWaxPayment();\n    }, 5000);\n\n})( jQuery );\n"]}